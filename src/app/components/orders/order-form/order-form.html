<div class="order-form-container">
  <h2 class="mat-title">{{ data.customerName ? 'Customer ' + data.customerName + ' - New Order' : 'New Order' }}</h2>
  
  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
    <div class="form-section">
      <h3 class="section-title">Order</h3>
      
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Employee*</mat-label>
          <mat-select formControlName="empId">
            <mat-option *ngFor="let employee of employees" [value]="employee.id">
              {{ employee.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="orderForm.get('empId')?.hasError('required')">
            Employee is required
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Shipper*</mat-label>
          <mat-select formControlName="shipperId">
            <mat-option *ngFor="let shipper of shippers" [value]="shipper.id">
              {{ shipper.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="orderForm.get('shipperId')?.hasError('required')">
            Shipper is required
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ship Name*</mat-label>
          <input matInput formControlName="shipName">
          <mat-error *ngIf="orderForm.get('shipName')?.hasError('required')">
            Ship Name is required
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ship Address*</mat-label>
          <input matInput formControlName="shipAddress">
          <mat-error *ngIf="orderForm.get('shipAddress')?.hasError('required')">
            Ship Address is required
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Ship City*</mat-label>
          <input matInput formControlName="shipCity">
          <mat-error *ngIf="orderForm.get('shipCity')?.hasError('required')">
            Ship City is required
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Ship Country*</mat-label>
          <input matInput formControlName="shipCountry">
          <mat-error *ngIf="orderForm.get('shipCountry')?.hasError('required')">
            Ship Country is required
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Order Date*</mat-label>
          <input matInput [matDatepicker]="orderDatePicker" formControlName="orderDate">
          <mat-datepicker-toggle matSuffix [for]="orderDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #orderDatePicker></mat-datepicker>
          <mat-error *ngIf="orderForm.get('orderDate')?.hasError('required')">
            Order Date is required
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Required Date*</mat-label>
          <input matInput [matDatepicker]="requiredDatePicker" formControlName="requiredDate">
          <mat-datepicker-toggle matSuffix [for]="requiredDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #requiredDatePicker></mat-datepicker>
          <mat-error *ngIf="orderForm.get('requiredDate')?.hasError('required')">
            Required Date is required
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Shipped Date</mat-label>
          <input matInput [matDatepicker]="shippedDatePicker" formControlName="shippedDate">
          <mat-datepicker-toggle matSuffix [for]="shippedDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #shippedDatePicker></mat-datepicker>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>$ Freight*</mat-label>
          <input matInput type="number" formControlName="freight">
        </mat-form-field>
      </div>
    </div>
    
    <div class="form-section">
      <h3 class="section-title">Order Details</h3>
      
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Product*</mat-label>
          <mat-select formControlName="productId">
            <mat-option *ngFor="let product of products" [value]="product.id">
              {{ product.name }} - ${{ product.price.toFixed(2) }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="orderForm.get('productId')?.hasError('required')">
            Product is required
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>$ Unit Price*</mat-label>
          <input matInput type="number" formControlName="unitPrice">
          <mat-error *ngIf="orderForm.get('unitPrice')?.hasError('required')">
            Unit price is required
          </mat-error>
          <mat-error *ngIf="orderForm.get('unitPrice')?.hasError('min')">
            Unit price must be positive
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Quantity*</mat-label>
          <input matInput type="number" formControlName="quantity">
          <mat-error *ngIf="orderForm.get('quantity')?.hasError('required')">
            Quantity is required
          </mat-error>
          <mat-error *ngIf="orderForm.get('quantity')?.hasError('min')">
            Quantity must be at least 1
          </mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Discount (%)*</mat-label>
          <input matInput type="number" formControlName="discount">
          <mat-error *ngIf="orderForm.get('discount')?.hasError('required')">
            Discount is required
          </mat-error>
          <mat-error *ngIf="orderForm.get('discount')?.hasError('min') || orderForm.get('discount')?.hasError('max')">
            Discount must be between 0 and 100
          </mat-error>
        </mat-form-field>
      </div>
      
      <div class="form-row total-row">
        <div class="total-label">Total:</div>
        <div class="total-value">${{ calculateTotal() }}</div>
      </div>
      
      <!-- Para futuras implementaciones: botón para agregar más productos -->
      <div class="form-row action-row">
        <button type="button" mat-stroked-button color="primary" class="add-product-btn" matTooltip="This feature will be implemented in a future version">
          <mat-icon>add</mat-icon> Add Another Product
        </button>
      </div>
    </div>
    
    <div class="dialog-actions">
      <button type="button" mat-button (click)="close()" [disabled]="loading">CLOSE</button>
      <button type="submit" mat-raised-button color="primary" [disabled]="orderForm.invalid || loading">
        <mat-spinner diameter="20" *ngIf="loading" class="button-spinner"></mat-spinner>
        <span>SAVE</span>
      </button>
    </div>
  </form>
</div>
